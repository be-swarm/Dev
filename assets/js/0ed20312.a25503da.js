"use strict";(self.webpackChunkdev=self.webpackChunkdev||[]).push([[7342],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=u(n),m=i,f=d["".concat(s,".").concat(m)]||d[m]||c[m]||r;return n?a.createElement(f,l(l({ref:t},p),{},{components:n})):a.createElement(f,l({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,l=new Array(r);l[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var u=2;u<r;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5776:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>r,metadata:()=>o,toc:()=>u});var a=n(7462),i=(n(7294),n(3905));const r={sidebar_position:4},l=void 0,o={unversionedId:"DevApps/NotionsDeBase/Authentification",id:"DevApps/NotionsDeBase/Authentification",title:"Authentification",description:"Pour des questions de s\xe9curit\xe9 et de confidentialit\xe9 des informations d'identification de l'utilisateur, une application ne peut",source:"@site/docs/DevApps/NotionsDeBase/Authentification.md",sourceDirName:"DevApps/NotionsDeBase",slug:"/DevApps/NotionsDeBase/Authentification",permalink:"/Dev/docs/DevApps/NotionsDeBase/Authentification",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Inscrire son application",permalink:"/Dev/docs/DevApps/NotionsDeBase/Inscrire son application"},next:{title:"Le jeton JWT",permalink:"/Dev/docs/DevApps/NotionsDeBase/LejetonJWT"}},s={},u=[{value:"L&#39;application invoque l&#39;url d&#39;authentification de BeSwarm",id:"lapplication-invoque-lurl-dauthentification-de-beswarm",level:4},{value:"L&#39;application est rappel\xe9e via son url de rappel",id:"lapplication-est-rappel\xe9e-via-son-url-de-rappel",level:4},{value:"R\xe9cup\xe9ration du jeton",id:"r\xe9cup\xe9ration-du-jeton",level:4}],p={toc:u};function c(e){let{components:t,...r}=e;return(0,i.kt)("wrapper",(0,a.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Pour des questions de s\xe9curit\xe9 et de confidentialit\xe9 des informations d'identification de l'utilisateur, une application ne peut\ninvoquer l'authentification d'un utilisateur que par un m\xe9cansime avec une logique de type  oauth2."),(0,i.kt)("p",null,"L'authentification Oauth2 de BeSwarm reprend les principes de base d'une authentification OAuth2 avec toutefois\ndes sp\xe9cificit\xe9s propres \xe0 la plateforme."),(0,i.kt)("p",null,"Pour rappel lorsque l'application a \xe9t\xe9 enregistr\xe9e, il a \xe9t\xe9 fourni des informations sur l'enregistrement oauth2 avec notamment l'url de rappel et le\nsecret afin de r\xe9cup\xe9rer le jeton authentifiant l'utilisateur."),(0,i.kt)("p",null,"Pour faire tr\xe8s simple une authentification oauth2 se d\xe9roule en plusieurs \xe9tapes:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"L'application invoque l'url d'authentification de BeSwarm."),(0,i.kt)("li",{parentName:"ul"},"L'utilisateur est redirig\xe9 vers BeSwarm pour s'authentifier."),(0,i.kt)("li",{parentName:"ul"},"L'utilisateur s'identifie et accepte l'acc\xe8s \xe0 ses donn\xe9es."),(0,i.kt)("li",{parentName:"ul"},"L'authentification BeSwarm rappelle l'application (avec l'url de rappel)"),(0,i.kt)("li",{parentName:"ul"},"L'application r\xe9cup\xe8re le jeton d'acc\xe8s \xe0 l'aide du secret et de l'url de rappel.\t")),(0,i.kt)("p",null,"Nous allons d\xe9tailler chacune de ces \xe9tapes."),(0,i.kt)("h4",{id:"lapplication-invoque-lurl-dauthentification-de-beswarm"},"L'application invoque l'url d'authentification de BeSwarm"),(0,i.kt)("p",null,"Lorsque l'application a \xe9t\xe9 cr\xe9e il lui a \xe9t\xe9 attribu\xe9 un indentifiant unique.\nCet identifiant se trouve dans l'onglet authentification de l'application.\n",(0,i.kt)("img",{alt:"Auth1",src:n(3721).Z,width:"855",height:"604"}),"\nUn bouton bouton permet de le copier dans le presse papier."),(0,i.kt)("p",null,"L'application doit invoquer l'url d'authentification de BeSwarm en lui passant divers param\xe8tres:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"un state"),(0,i.kt)("li",{parentName:"ul"},"l'identifiant de l'application"),(0,i.kt)("li",{parentName:"ul"},"un code_challenge"),(0,i.kt)("li",{parentName:"ul"},"l'url de rappel  (attention:l'url de rappel est sensible \xe0 la casse)")),(0,i.kt)("p",null,"Le state est une chaine al\xe9atoire qui sera retourn\xe9e \xe0 l'application afin qu'elle puisse s'assurer que l'url de rappel est bien celle que l'application\na initi\xe9.\nLe code_challenge est une chaine al\xe9atoire qui devra \xeatre fournie pour r\xe9cup\xe9rer le jeton d'acc\xe8s. Il permet de s'assurer que la demande de jeton \xe9mane bien d'une application\nqui a init\xe9 la demande d'authentification.\nL'url de rappel doit faire partie des urls configur\xe9es dans la partie oauth de l'application."),(0,i.kt)("admonition",{title:"Information  ",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Lors de l'appel de l'url d'authentification c'est le hash SHA256 du code_challenge qui doit \xeatre pass\xe9.\nex: Si le code challenge gen\xe9r\xe9 par l'application est le 9819811 il faudra passer la chaine\n93439d0ad840e635cd82374dd2dc5b010d1c8a14bfc8561c5faa487e53be51d")),(0,i.kt)("p",null,"Exemple:\n",(0,i.kt)("a",{parentName:"p",href:"https://dev.beswarm.net/Authorize"},"https://dev.beswarm.net/Authorize"),"?\nstate=monetat\n&appid=67859daa-76d4-4c74-a27c-d76cf7f8842e.c52de624-986a-43d5-9b9f-056823c04018.providerswarm\n&code_challenge=993439d0ad840e635cd82374dd2dc5b010d1c8a14bfc8561c5faa487e53be51d\n&callbackuri=",(0,i.kt)("a",{parentName:"p",href:"https://mysite.com/login"},"https://mysite.com/login")),(0,i.kt)("h4",{id:"lapplication-est-rappel\xe9e-via-son-url-de-rappel"},"L'application est rappel\xe9e via son url de rappel"),(0,i.kt)("p",null,"Si l'utilisateur c'est correctement authentifi\xe9 et qu'il a accept\xe9 les autorisations d'acc\xe8s demand\xe9es par l'application, BeSwarm rappelle l'application\nvia son url de rappel avec les informations suivantes:\n",(0,i.kt)("a",{parentName:"p",href:"https://www.monapp.fr/login?state=monetat&code=YWU5M2FhM2YtMTZkMi00MWUzLTkxM2UtZTQxZjc5YzM4ODUy&swarm=userswarm&serviceurl=https://dev2.beswarm.net"},"https://www.monapp.fr/login?state=monetat&code=YWU5M2FhM2YtMTZkMi00MWUzLTkxM2UtZTQxZjc5YzM4ODUy&swarm=userswarm&serviceurl=https://dev2.beswarm.net")),(0,i.kt)("p",null,"state retourne le state pass\xe9 lors de l'appel de l'url beswarm. L'application peut s'assurer que c'est bien celui qu'elle a g\xe9n\xe9r\xe9."),(0,i.kt)("p",null,"code est le code d'\xe9change qui permettra \xe0 l'application de r\xe9cup\xe9rer le jeton d'acc\xe8s."),(0,i.kt)("p",null,"swarm est l'essaim sur lequel l'utilistaeur c'est authentifi\xe9."),(0,i.kt)("p",null,"serviceurl est l'url de service sur lequel l'utilisateur s'est authentifi\xe9."),(0,i.kt)("p",null,"Il est important \xe0 ce stade de comprendre ce qui a \xe9t\xe9 retourn\xe9 et notamment le serviceurl.\nPour rappel l'environnement BeSwarm est totalement d\xe9centralis\xe9 et il peut exister autant de services que d'essaims.\nL'application ne connaissant pas l'utilisateur n'a donc aucun moyen de savoir quel service invoquer ni quel essaim utiliser.\nC'est pour cela qu'elle fait une demande d'authentfication sur n'importe quel service et c'est l'authentification Be Swarm qui en fonction de l'essaim selectionn\xe9\npar l'utilistateur retournera l'url du service qui g\xe8re cet essaim.\nCar c'est sur cette url que le jeton deva \xeatre r\xe9cup\xe9r\xe9."),(0,i.kt)("h4",{id:"r\xe9cup\xe9ration-du-jeton"},"R\xe9cup\xe9ration du jeton"),(0,i.kt)("p",null,"La r\xe9cup\xe9ration du jeton se fait via une url en post.\nL'url est \xe0 envoyer sur le service retourn\xe9 par serviceurl.\nDans notre exemple ce sera ",(0,i.kt)("a",{parentName:"p",href:"https://dev2.beswarm.net/api/access/v1/usertoken"},"https://dev2.beswarm.net/api/access/v1/usertoken"),"\navec comme corps de requ\xeate les donn\xe9es suivantes"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},'{ "code_challenge":"9819811",\n   "client_secret":"MonSecret",\n   "code":"YWU5M2FhM2YtMTZkMi00MWUzLTkxM2UtZTQxZjc5YzM4ODUy",\n   "swarm":"userswarm"\n}\n')),(0,i.kt)("p",null,"code_challenge est le code_challenge g\xe9n\xe9r\xe9 lors de l'appel de l'url d'authentification."),(0,i.kt)("p",null,"clien_secret est le secret de l'application tel que d\xe9fini dans la partie enregistrement oauth2 de l'application."),(0,i.kt)("p",null,"code est le code retourn\xe9 par l'url de rappel."),(0,i.kt)("p",null,"swarm est l'essaim sur lequel l'utilisateur s'est authentifi\xe9 et qui est retourn\xe9 par l'url de rappel."),(0,i.kt)("p",null,"D\xe8s lors l'application va recevoir le jeton d'authentification qui lui permettra d'acc\xe9der aux donn\xe9es de l'utilisateur."),(0,i.kt)("admonition",{title:"Important  ",type:"warning"},(0,i.kt)("p",{parentName:"admonition"}," L'application doit \xeatre en mesure de garder secret tous les identifiants qu'elle a eu \xe0 fournir comme:\nl'appid, le client_secret et le code_challenge.\nSi l'appid ou le client_secret sont divulgu\xe9s, une application malveillante pourrait usurper l'identit\xe9 de l'application et r\xe9cup\xe9rer des jetons d'acc\xe8s.\nSi le code_challenge est divulgu\xe9, une application malveillante pourrait renouveler le jeton d'acc\xe8s.")))}c.isMDXComponent=!0},3721:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/auth1-ffaed4f6967846eb58c7b80dccb4d779.png"}}]);