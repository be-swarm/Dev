"use strict";(self.webpackChunkdev=self.webpackChunkdev||[]).push([[5623],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>f});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=r.createContext({}),u=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(o.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(n),m=a,f=c["".concat(o,".").concat(m)]||c[m]||d[m]||i;return n?r.createElement(f,l(l({ref:t},p),{},{components:n})):r.createElement(f,l({ref:t},p))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=m;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s[c]="string"==typeof e?e:a,l[1]=s;for(var u=2;u<i;u++)l[u]=n[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7803:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var r=n(7462),a=(n(7294),n(3905));const i={sidebar_position:5,title:"Le jeton JWT"},l=void 0,s={unversionedId:"DevApps/NotionsDeBase/LejetonJWT",id:"DevApps/NotionsDeBase/LejetonJWT",title:"Le jeton JWT",description:"Lorsque l'application a re\xe7u un jeton d'acc\xe8s elle devra le fournir dans les requ\xeates HTTP pour acc\xe9der aux donn\xe9es de l'utilisateur.",source:"@site/docs/DevApps/NotionsDeBase/LejetonJWT.md",sourceDirName:"DevApps/NotionsDeBase",slug:"/DevApps/NotionsDeBase/LejetonJWT",permalink:"/Dev/docs/DevApps/NotionsDeBase/LejetonJWT",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,title:"Le jeton JWT"},sidebar:"tutorialSidebar",previous:{title:"Authentification",permalink:"/Dev/docs/DevApps/NotionsDeBase/Authentification"},next:{title:"Les Web API",permalink:"/Dev/docs/category/les-web-api"}},o={},u=[{value:"Comment utiliser le jeton utilisateur",id:"comment-utiliser-le-jeton-utilisateur",level:2},{value:"Utiliser la liste des hosts",id:"utiliser-la-liste-des-hosts",level:2},{value:"Utiliser le contenu du jeton",id:"utiliser-le-contenu-du-jeton",level:2},{value:"V\xe9rifier la signature du jeton",id:"v\xe9rifier-la-signature-du-jeton",level:3},{value:"Renouveler le jeton utilisateur",id:"renouveler-le-jeton-utilisateur",level:2}],p={toc:u},c="wrapper";function d(e){let{components:t,...i}=e;return(0,a.kt)(c,(0,r.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Lorsque l'application a re\xe7u un jeton d'acc\xe8s elle devra le fournir dans les requ\xeates HTTP pour acc\xe9der aux donn\xe9es de l'utilisateur."),(0,a.kt)("p",null,"Les donn\xe9es retourn\xe9es sont d'une part le jeton d'acc\xe8s JWT mais aussi d'autres informations n\xe9cessaires afin d'appeler correctement\nles urls des services concern\xe9s."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Jwt",src:n(2567).Z,width:"1420",height:"571"})),(0,a.kt)("p",null,"la strucure de donn\xe9es contient:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"le jeton utilisateur (userotken)")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"sa dur\xe9e de validit\xe9")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"la ou les urls de services utilisables avec ce jeton")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"le jeton applicatif (applicationtotken)")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"sa dur\xe9e de validit\xe9")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"la ou les urls de services utilisables avec ce jeton"))),(0,a.kt)("p",null,"Le jeton applicatif permet d'acc\xe9der aux informations relatives \xe0 l'application."),(0,a.kt)("h2",{id:"comment-utiliser-le-jeton-utilisateur"},"Comment utiliser le jeton utilisateur"),(0,a.kt)("p",null,"Il est \xe0 passer via le header Authorize de la requ\xeate HTTP sous la forme suivante:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Authorization: Bearer <uid_token>\n")),(0,a.kt)("h2",{id:"utiliser-la-liste-des-hosts"},"Utiliser la liste des hosts"),(0,a.kt)("p",null,"Il est important de bien comprendre cette section car elle d\xe9termine comment il faut appeler les wedbapi."),(0,a.kt)("p",null,"La liste qui est retourn\xe9e avec le jeton est une liste g\xe9n\xe9rique qui contient les points d'entr\xe9e qui peuvent potentiellement\nserivr les webapi sur l'essaim de l'utilisateur."),(0,a.kt)("admonition",{type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"Cette liste n'est pas \xe0 utiliser directement pour invoquer les webapi car il n'y a aucune garantie que le point d'entr\xe9e serve cette webapi.")),(0,a.kt)("p",null,"Pour cela il faut invoquer la webapi api/core/v1/discovery/role sur une de ces urls. En retour il sera retourn\xe9 la liste des points d'entr\xe9e qui peuvent effectievement\nservir cette webapi.\nPour des raisons de performance, l'appllication n'a pas \xe0 invoquer syst\xe9matiquement cette webapi. Elle peut le faire au d\xe9marrage en fonction des webapi qu'elle compte utiliser\net garder cette liste pour ces futurs appels."),(0,a.kt)("p",null,"Ex: L'application a re\xe7u deux hosts avec son jeton "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://beswarm-1.beswarm.com"},"https://beswarm-1.beswarm.com")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://beswarm-2.beswarm.com"},"https://beswarm-2.beswarm.com"))),(0,a.kt)("p",null,"elle souhaite appeler des webapi du role api/foorder"),(0,a.kt)("p",null,"elle appelle donc ",(0,a.kt)("a",{parentName:"p",href:"https://beswarm-1.beswarm.com/api/core/v1/discovery/api/foodoffer"},"https://beswarm-1.beswarm.com/api/core/v1/discovery/api/foodoffer"),"\nEn retour elle re\xe7oit une liste qui contient ",(0,a.kt)("a",{parentName:"p",href:"https://beswarm-2.beswarm.com"},"https://beswarm-2.beswarm.com"),"\nCela veut dire que ",(0,a.kt)("a",{parentName:"p",href:"https://beswarm-1.beswarm.com"},"https://beswarm-1.beswarm.com")," n'est pas en mesure de servir cette webapi et que seule ",(0,a.kt)("a",{parentName:"p",href:"https://beswarm-2.beswarm.com"},"https://beswarm-2.beswarm.com")," doit \xeatre utilis\xe9e\npour tous les appels \xe0 ces webapi."),(0,a.kt)("p",null,"Elle aurait \xe9galement pu invoquer ",(0,a.kt)("a",{parentName:"p",href:"https://beswarm-2.beswarm.com/api/core/v1/discovery/api/foodoffer"},"https://beswarm-2.beswarm.com/api/core/v1/discovery/api/foodoffer")," qui aurait retourn\xe9 le m\xeame r\xe9sultat."),(0,a.kt)("p",null,"L'application peut \xe9galement raffra\xeechir la liste de urls retourn\xe9es avec le jetoon avec la webapi api/core/v1/discovery\nL'appel peut \xeatre justifi\xe9 si pour une raison quelconque toutes les urls qu'elle a re\xe7u initialement se retrouvent invalides, ce qui a peu de chances d'arriver."),(0,a.kt)("h2",{id:"utiliser-le-contenu-du-jeton"},"Utiliser le contenu du jeton"),(0,a.kt)("p",null,"L'application peut utiliser le contenu du jeton afin de conna\xeetre diverses informations sur l'utilisateur."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'{\n  "tokentype": "User",\n  "iss": "BeSwarm",\n  "nonce": "93439d0ad840e635cd82374dd2dc5b010d1c8a14bfc8561c5faa487e53be51d",\n  "scope": "{\\"userbankaccount\\":{\\"read\\":true,\\"write\\":true,\\"delete\\":false},\\"userbankaccountsold\\":{\\"read\\":true,\\"write\\":true,\\"delete\\":true},\\"userbankaccounttransaction\\":{\\"read\\":true,\\"write\\":true,\\"delete\\":true}}",\n  "funcs": "[]",\n  "aud": "*",\n  "swarmid": "testdev",\n  "lang": "FR",\n  "private": "@3F2YRjco2P4df5yXUE3L+zskjfXHfkBbLu8hd5Yr1rhj+3+Kq4NBm9DQK1KXkdifKT4oxnkDlpJGd7yqFoeox/R/xqojHHLRFWMrGnpH38ajTDII4y/SzscdpDckNVGgnIEY2Hv2WI/otTTKTrY3MQMf0y+uZS1JwY3jFXLhMbHEDI4d0esoW8kI4QEzyMJm3GvtQTPmPk1Yon7bz1cbsqo/1Cw85Z7ABrdnv4sHqTdIKA5FeBb2ykRQDD2fmahCiOshkZ5bdKgGzw8Yj/AiGDHk++DM3BPKqNARK2nYa8Q0=",\n  "nbf": 1668590864,\n  "exp": 1668806864\n}\n')),(0,a.kt)("p",null,"Les informations utiles sont"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"nonce qui correspond au SHA56 du code challenge. L'application peut contr\xf4ler que ce jeton est bien celui de la session utilisateur."),(0,a.kt)("li",{parentName:"ul"},"scope qui permet \xe0 l'application de voir les droits effectivement octroy\xe9s par l'utilisateur."),(0,a.kt)("li",{parentName:"ul"},"lang qui contient la langue de l'utilisateur."),(0,a.kt)("li",{parentName:"ul"},"nbf et exp qui contiennent la p\xe9riode de validit\xe9 du jeton.")),(0,a.kt)("admonition",{title:"Information",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Comme nous le voyons et conform\xe9mement \xe0 la politique de confidentialit\xe9 de BeSwarm, aucune information permettant d'identifier\nl'utilisateur est pr\xe9sente dans le jeton.")),(0,a.kt)("h3",{id:"v\xe9rifier-la-signature-du-jeton"},"V\xe9rifier la signature du jeton"),(0,a.kt)("p",null,"Afin de v\xe9rifier que le jeton a bien \xe9t\xe9 \xe9mis par un service BeSwarm, l'application peut v\xe9rifier la signature du jeton.\nLes informations de signature sont pr\xe9sentes dans l'en-t\xeate du jeton."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'{\n  "alg": "http://www.w3.org/2001/04/xmldsig-more#rsa-sha256",\n  "typ": "JWT",\n  "kid": "k1"\n}\n')),(0,a.kt)("p",null,"Actuellement BeSwarm signe ses jetons avec une clef RSA.\nL'application peut v\xe9rfier la signature gr\xe2ce \xe0 la clef publique.\nCette derni\xe8re est accessible via une webapi\nhttps://....service....>/api/v1/core/publickey\nqui retournera:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'{\n  "datas": [\n    {\n      "indice": "k1",\n      "key": "<RSAKeyValue><Modulus>roMvi/dl9chzaJDl84tNC0h35FG9HfKuZbTKmbW9PWXIWV+wMlff14TK0ptp7mUDvOGhJl+M21fXWttLUC7gfYhOSQGgSrCi/hAxo440AwrNlydItOembtmxwq2c8K5Ssni9AVrZA2NpqU+3shnK31m9MA7AY5z8+6OYU+H8os2m20c7k2XQz4NBEB2cicRAOrnSgpJQ1dXOTR2rVAn0kFTmRywajPvd+z3W9B/rUuw4CmR17aKItJ2wMteiGB8FlIgTCV2I0CikdI0/prxn35UvGjByoz/zqYi/Z5rzdZ/SL7P9kj/lW5JW0pgt98hyn8rJpRCCQtHzCAxxflSkVw==</Modulus><Exponent>AQAB</Exponent></RSAKeyValue>"\n    }\n  ]\n}\n')),(0,a.kt)("h2",{id:"renouveler-le-jeton-utilisateur"},"Renouveler le jeton utilisateur"),(0,a.kt)("p",null,"Tout jeton utilisateur a une dur\xe9e de validit\xe9 limit\xe9e. Cette dur\xe9e est indiqu\xe9e dans le champ expires_in et expires_at.\nElle est variable et est sp\xe9cifi\xe9e par l'utilisateur.\nSi ce dernier a autoris\xe9 le renouvellement de jeton, l'application peut renouveler un jeton p\xe9rim\xe9 en appelant l'url suivante:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"<url de service>/api/access/v1/refreshtoken\n")),(0,a.kt)("p",null,"L'appel est en faire en post avec le corps suivant:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'{ "Token": "<uid_token>",\n  "Code_challenge":"<code_challenge>"\n}\n')))}d.isMDXComponent=!0},2567:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/jwt-25ed01a3f4ce680126d348227a2bb1df.png"}}]);