"use strict";(self.webpackChunkdev=self.webpackChunkdev||[]).push([[623],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=u(n),m=i,f=d["".concat(s,".").concat(m)]||d[m]||c[m]||a;return n?r.createElement(f,l(l({ref:t},p),{},{components:n})):r.createElement(f,l({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,l=new Array(a);l[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var u=2;u<a;u++)l[u]=n[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7803:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>a,metadata:()=>o,toc:()=>u});var r=n(7462),i=(n(7294),n(3905));const a={sidebar_position:5,title:"Le jeton JWT"},l=void 0,o={unversionedId:"DevApps/NotionsDeBase/LejetonJWT",id:"DevApps/NotionsDeBase/LejetonJWT",title:"Le jeton JWT",description:"Lorsque l'application a re\xe7u un jeton d'acc\xe8s elle devra le fournir dans les requ\xeates HTTP pour acc\xe9der aux donn\xe9es de l'utilisateur.",source:"@site/docs/DevApps/NotionsDeBase/LejetonJWT.md",sourceDirName:"DevApps/NotionsDeBase",slug:"/DevApps/NotionsDeBase/LejetonJWT",permalink:"/Dev/docs/DevApps/NotionsDeBase/LejetonJWT",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,title:"Le jeton JWT"},sidebar:"tutorialSidebar",previous:{title:"Authentification",permalink:"/Dev/docs/DevApps/NotionsDeBase/Authentification"},next:{title:"Les Web API",permalink:"/Dev/docs/category/les-web-api"}},s={},u=[{value:"Comment utiliser le jeton utilisateur",id:"comment-utiliser-le-jeton-utilisateur",level:2},{value:"Utiliser le contenu du jeton",id:"utiliser-le-contenu-du-jeton",level:2},{value:"V\xe9rifier la signature du jeton",id:"v\xe9rifier-la-signature-du-jeton",level:3},{value:"Renouveler le jeton utilisateur",id:"renouveler-le-jeton-utilisateur",level:2}],p={toc:u};function c(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,r.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Lorsque l'application a re\xe7u un jeton d'acc\xe8s elle devra le fournir dans les requ\xeates HTTP pour acc\xe9der aux donn\xe9es de l'utilisateur."),(0,i.kt)("p",null,"Les donn\xe9es retourn\xe9es sont d'une part le jeton d'acc\xe8s JWT mais aussi d'autres informations n\xe9cessaires afin d'appeler correctement\nles urls des services concern\xe9s."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Jwt",src:n(2567).Z,width:"1420",height:"571"})),(0,i.kt)("p",null,"la strucure de donn\xe9es contient:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"le jeton utilisateur (userotken)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"sa dur\xe9e de validit\xe9")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"la ou les urls de services utilisables avec ce jeton")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"le jeton applicatif (applicationtotken)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"sa dur\xe9e de validit\xe9")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"la ou les urls de services utilisables avec ce jeton"))),(0,i.kt)("p",null,"Le jeton applicatif permet d'acc\xe9der aux informations relatives \xe0 l'application."),(0,i.kt)("h2",{id:"comment-utiliser-le-jeton-utilisateur"},"Comment utiliser le jeton utilisateur"),(0,i.kt)("p",null,"Il est \xe0 passer via le header Authorize de la requ\xeate HTTP sous la forme suivante:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Authorization: Bearer <uid_token>\n")),(0,i.kt)("p",null,"La liste des Hosts est la liste des services sur lesquels le jeton est utilisable.\nTypiquement ce sont les services qui g\xe8rent l'essaim ou sont stock\xe9es les donn\xe9es de l'utilisateur."),(0,i.kt)("p",null,"L'application peut exploiter cette liste afin de faire du load balancing sur les diff\xe9rents services pour ses requ\xeates\net/ou pour changer de service si un venait \xe0 \xeatre indisponible."),(0,i.kt)("h2",{id:"utiliser-le-contenu-du-jeton"},"Utiliser le contenu du jeton"),(0,i.kt)("p",null,"L'application peut utiliser le contenu du jeton afin de conna\xeetre diverses informations sur l'utilisateur."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},'{\n  "tokentype": "User",\n  "iss": "BeSwarm",\n  "nonce": "93439d0ad840e635cd82374dd2dc5b010d1c8a14bfc8561c5faa487e53be51d",\n  "scope": "{\\"userbankaccount\\":{\\"read\\":true,\\"write\\":true,\\"delete\\":false},\\"userbankaccountsold\\":{\\"read\\":true,\\"write\\":true,\\"delete\\":true},\\"userbankaccounttransaction\\":{\\"read\\":true,\\"write\\":true,\\"delete\\":true}}",\n  "funcs": "[]",\n  "aud": "*",\n  "swarmid": "testdev",\n  "lang": "FR",\n  "private": "@3F2YRjco2P4df5yXUE3L+zskjfXHfkBbLu8hd5Yr1rhj+3+Kq4NBm9DQK1KXkdifKT4oxnkDlpJGd7yqFoeox/R/xqojHHLRFWMrGnpH38ajTDII4y/SzscdpDckNVGgnIEY2Hv2WI/otTTKTrY3MQMf0y+uZS1JwY3jFXLhMbHEDI4d0esoW8kI4QEzyMJm3GvtQTPmPk1Yon7bz1cbsqo/1Cw85Z7ABrdnv4sHqTdIKA5FeBb2ykRQDD2fmahCiOshkZ5bdKgGzw8Yj/AiGDHk++DM3BPKqNARK2nYa8Q0=",\n  "nbf": 1668590864,\n  "exp": 1668806864\n}\n')),(0,i.kt)("p",null,"Les informations utiles sont"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"nonce qui correspond au SHA56 du code challenge. L'application peut contr\xf4ler que ce jeton est bien celui de la session utilisateur."),(0,i.kt)("li",{parentName:"ul"},"scope qui permet \xe0 l'application de voir les droits effectivement octroy\xe9s par l'utilisateur."),(0,i.kt)("li",{parentName:"ul"},"lang qui contient la langue de l'utilisateur."),(0,i.kt)("li",{parentName:"ul"},"nbf et exp qui contiennent la p\xe9riode de validit\xe9 du jeton.")),(0,i.kt)("admonition",{title:"Information",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Comme nous le voyons et conform\xe9mement \xe0 la politique de confidentialit\xe9 de BeSwarm, aucune information permettant d'identifier\nl'utilisateur est pr\xe9sente dans le jeton.")),(0,i.kt)("h3",{id:"v\xe9rifier-la-signature-du-jeton"},"V\xe9rifier la signature du jeton"),(0,i.kt)("p",null,"Afin de v\xe9rifier que le jeton a bien \xe9t\xe9 \xe9mis par un service BeSwarm, l'application peut v\xe9rifier la signature du jeton.\nLes informations de signature sont pr\xe9sentes dans l'en-t\xeate du jeton."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},'{\n  "alg": "http://www.w3.org/2001/04/xmldsig-more#rsa-sha256",\n  "typ": "JWT",\n  "kid": "k1"\n}\n')),(0,i.kt)("p",null,"Actuellement BeSwarm signe ses jetons avec une clef RSA.\nL'application peut v\xe9rfier la signature gr\xe2ce \xe0 la clef publique.\nCette derni\xe8re est accessible via une webapi\nhttps://....service....>/api/v1/core/publickey\nqui retournera:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},'{\n  "datas": [\n    {\n      "indice": "k1",\n      "key": "<RSAKeyValue><Modulus>roMvi/dl9chzaJDl84tNC0h35FG9HfKuZbTKmbW9PWXIWV+wMlff14TK0ptp7mUDvOGhJl+M21fXWttLUC7gfYhOSQGgSrCi/hAxo440AwrNlydItOembtmxwq2c8K5Ssni9AVrZA2NpqU+3shnK31m9MA7AY5z8+6OYU+H8os2m20c7k2XQz4NBEB2cicRAOrnSgpJQ1dXOTR2rVAn0kFTmRywajPvd+z3W9B/rUuw4CmR17aKItJ2wMteiGB8FlIgTCV2I0CikdI0/prxn35UvGjByoz/zqYi/Z5rzdZ/SL7P9kj/lW5JW0pgt98hyn8rJpRCCQtHzCAxxflSkVw==</Modulus><Exponent>AQAB</Exponent></RSAKeyValue>"\n    }\n  ]\n}\n')),(0,i.kt)("h2",{id:"renouveler-le-jeton-utilisateur"},"Renouveler le jeton utilisateur"),(0,i.kt)("p",null,"Tout jeton utilisateur a une dur\xe9e de validit\xe9 limit\xe9e. Cette dur\xe9e est indiqu\xe9e dans le champ expires_in et expires_at.\nElle est variable et est sp\xe9cifi\xe9e par l'utilisateur.\nSi ce dernier a autoris\xe9 le renouvellement de jeton, l'application peut renouveler un jeton p\xe9rim\xe9 en appelant l'url suivante:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"<url de service>/api/access/v1/refreshtoken\n")),(0,i.kt)("p",null,"L'appel est en faire en post avec le corps suivant:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},'{ "Token": "<uid_token>",\n  "Code_challenge":"<code_challenge>"\n}\n')))}c.isMDXComponent=!0},2567:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/jwt-25ed01a3f4ce680126d348227a2bb1df.png"}}]);